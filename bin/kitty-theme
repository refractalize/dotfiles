#!/usr/bin/env zsh

zparseopts -D -A opts -tab=tab -choose=choose

THEME=$1
KITTY_CUSTOM_DIR=~/.config/kitty/themes
KITTY_THEME_ZIP=~/Library/Caches/kitty/kitty-themes.zip

if [[ -n $tab ]]
then
  TAB=(--match-tab recent:0)
else
  TAB=""
fi

theme() {
  [[ -f $KITTY_CUSTOM_DIR/$THEME.conf ]] && cat $KITTY_CUSTOM_DIR/$THEME.conf || unzip -p $KITTY_THEME_ZIP kitty-themes-master/themes/$THEME.conf
}

if [[ -z $THEME || -n $choose ]]
then
  THEME=$((ls -1 $KITTY_CUSTOM_DIR && unzip -qq -l $KITTY_THEME_ZIP | awk '/themes\/[^/]*\.conf/ { print $4 }' | xargs basename -s .conf) | fzf)
fi

kitty @ set-colors $TAB <(theme)

if [[ -n $choose ]]
then
  echo $THEME
fi
