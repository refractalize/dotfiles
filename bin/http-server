#!/usr/bin/env pogo

express = require 'express'
argv = require 'optimist'.default 'p' '4000'.alias 'p' 'port'.argv
compiler = require 'connect-compiler'

serve directory (dir) =
    app = express ()
    app.use (express.logger ())
    app.use (compiler {
        enabled [ 'less', 'pogo' ]
        dest '.cache'
    })
    app.use (express.static (dir))
    app.use (express.static ("#(dir)/.cache"))
    app.listen (parse int (argv.p))

dir = process.cwd ()
serve directory (dir)
console.log "serving #(dir) at http://localhost:#(argv.p)/"
