#!/usr/bin/env pogo

express = require 'express'
argv = require 'optimist'.default 'p' '4000'.alias 'p' 'port'.argv
compiler = require 'connect-compiler'
browserify = require 'browserify-middleware'

serve directory (dir) =
    app = express ()
    app.use (express.logger ())
    app.use ('/app.js', browserify ("#(process.cwd ())/app.pogo", {transform = ['pogoify'], extensions = ['.pogo']}))
    app.use (express.static (dir))
    app.use (express.static ("#(dir)/.cache"))
    app.listen (parse int (argv.p))

dir = process.cwd ()
serve directory (dir)
console.log "serving #(dir) at http://localhost:#(argv.p)/"
