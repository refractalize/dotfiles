#!/usr/bin/env zsh

DIR=$(mktemp -d)

cat | awk "
  BEGIN {
    skip_line = 0;
    part = 1;
    file = sprintf(\"$DIR/%08d.tty\", part);
  }

  /\033]133;A/ {
    skip_line = 1;
    part++;
    file = sprintf(\"$DIR/%08d.tty\", part);
  }

  !skip_line {
    print >file;
  }

  {
    skip_line = 0;
  }
"

FILES=($DIR/*)

sed -i '' -E 's/\x1b\].*\x1b\\//g' $FILES

nvim ${(O)FILES}

rm -rf $DIR
